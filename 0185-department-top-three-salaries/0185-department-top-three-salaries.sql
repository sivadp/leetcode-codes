select d.name as Department,s.Employee,s.Salary from (select distinct e.name as Employee,e.salary as Salary,s.departmentId as id from employee e join (select s.salary,s.departmentId from (select s.salary,s.departmentId,ROW_NUMBER() OVER (PARTITION BY s.DEPARTMENTID ORDER BY s.SALARY DESC) AS NUMB from (select distinct salary,departmentId from employee) as s order by departmentid,salary desc) as s where s.numb<4) as s on e.departmentId=s.departmentId and e.salary=s.salary) as s join department d on s.id=d.id ;